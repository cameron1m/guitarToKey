<!DOCTYPE html>
<html>
<script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
<script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>
<script src = "https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    
let mobilenet;
let video;
let classifier;
let value = 'needs training';
let sampleButton;
let saveButton;
let trainButton;
// let slider;
let wButton;
let aButton;
let sButton;
let dButton;
let upButton;
let downButton;
let leftButton;
let rightButton;
let nextWepButton;
let reloadWepButton;
let sprintButton;
let crouchButton;
let defaultButton;
let socket = io();

function modelReady() {
  console.log('Model is Ready!!');

    //mobilenet.predict(gotResults);

}

function videoReady(){
  console.log("Video is Ready!!");
  
}

function gotResults(error, result) {
  if (error) {
    console.error(error);
  } else {
    console.log(result);
    value = result[0].label + '    %Correct' + result[0].confidence;
    pack = result[0].label
    socket.emit('newPrediction', pack);

    classifier.classify(gotResults);

  }
}
function whileTraining(loss){
  if (loss == null){
    console.log('Training Comeplete!');
    classifier.classify(gotResults);
  }
  else {
    console.log(loss);
  }

  }
// function imageReady() {
//   image(video, 0, 0, width, height);
// }

function setup() {
  createCanvas(640, 550);
  video = createCapture(VIDEO);
  video.hide();
  background(0);
  mobilenet = ml5.featureExtractor('MobileNet',{numLabels:10}, modelReady);
  classifier = mobilenet.classification(video, videoReady);
  // sampleButton = createButton('Add Sample');

  // sampleButton.mousePressed(function(){
  //    classifier.addImage(slider.value());

  // });

  wButton = createButton('W');

  wButton.mousePressed(function(){
    classifier.addImage('W');
  });

  aButton = createButton('A');

  aButton.mousePressed(function(){
    classifier.addImage('A');
  });
  sButton = createButton('S');

  sButton.mousePressed(function(){
  classifier.addImage('S');
  });
  dButton = createButton('D');

  dButton.mousePressed(function(){
  classifier.addImage('D');
  });

  upButton = createButton('Up');

  upButton.mousePressed(function(){
  classifier.addImage('Up');
  });

  downButton = createButton('Down');

  downButton.mousePressed(function(){
  classifier.addImage('Down');
  });

  leftButton = createButton('Left');

  leftButton.mousePressed(function(){
  classifier.addImage('Left');
  });

  rightButton = createButton('Right');

  rightButton.mousePressed(function(){
  classifier.addImage('Right');
  });

  nextWepButton = createButton('Next Weapon');

  nextWepButton.mousePressed(function(){
  classifier.addImage('Next Weapon');
  });
  reloadWepButton = createButton('Reload');

  reloadWepButton.mousePressed(function(){
  classifier.addImage('Reload');
  });

  sprintButton = createButton('Sprint');

  sprintButton.mousePressed(function(){
  classifier.addImage('Sprint');
  });
  crouchButton = createButton('Crouch');

  crouchButton.mousePressed(function(){
  classifier.addImage('Crouch');
  });
  defaultButton = createButton('Default');

  defaultButton.mousePressed(function(){
    classifier.addImage('Default');
  });

  trainButton = createButton('Train');

  trainButton.mousePressed(function(){
    classifier.train(whileTraining);
  });
  
  saveButton = createButton('Save');

  saveButton.mousePressed(function(){
    classifier.save();
  });

  // loadButton = createButton('Load');

  // loadButton.mousePressed(function(){
  //   featureExtractor.load();
  // });
  
  // slider = createSlider(0,1,0.5,0.01);

}

function draw(){
  background(0);
  image(video, 0, 0);
  rectMode(CENTER);
  fill('red');
  textSize(32);
  // rect(value*width, height / 2,50,50);

  text(value, 10, 510);
}


</script>
    
</html>