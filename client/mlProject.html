<!DOCTYPE html>
<html>
<script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.js"></script>
<script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>
<script>
    
let mobilenet;
let video;
let classifier;
let value = 'needs training';
let sampleButton;
let saveButton;
let trainButton;
// let slider;
let oneButton;
let twoButton;
let defaultButton;


function modelReady() {
  console.log('Model is Ready!!');

    //mobilenet.predict(gotResults);

}

function videoReady(){
  console.log("Video is Ready!!");
  
}

function gotResults(error, result) {
  if (error) {
    console.error(error);
  } else {
    console.log(result);
    value = result[0].label + '    %Correct' + result[0].confidence;
  
    classifier.classify(gotResults);
    if(result[0].label == 'A'){
   
    }
  }
}
function whileTraining(loss){
  if (loss == null){
    console.log('Training Comeplete!');
    classifier.classify(gotResults);
  }
  else {
    console.log(loss);
  }

  }
// function imageReady() {
//   image(video, 0, 0, width, height);
// }

function setup() {
  createCanvas(640, 550);
  video = createCapture(VIDEO);
  video.hide();
  background(0);
  mobilenet = ml5.featureExtractor('MobileNet',{numLabels:3}, modelReady);
  classifier = mobilenet.classification(video, videoReady);
  // sampleButton = createButton('Add Sample');

  // sampleButton.mousePressed(function(){
  //    classifier.addImage(slider.value());

  // });

  oneButton = createButton('A');

  oneButton.mousePressed(function(){
    classifier.addImage('A');
  });

  twoButton = createButton('B');

  twoButton.mousePressed(function(){
    classifier.addImage('B');
  });

  defaultButton = createButton('Default');

  defaultButton.mousePressed(function(){
    classifier.addImage('Default');
  });

  trainButton = createButton('Train');

  trainButton.mousePressed(function(){
    classifier.train(whileTraining);
  });
  
  saveButton = createButton('Save');

  saveButton.mousePressed(function(){
    classifier.save();
  });

  // loadButton = createButton('Load');

  // loadButton.mousePressed(function(){
  //   featureExtractor.load();
  // });
  
  // slider = createSlider(0,1,0.5,0.01);

}

function draw(){
  background(0);
  image(video, 0, 0);
  rectMode(CENTER);
  fill('red');
  textSize(32);
  // rect(value*width, height / 2,50,50);

  text(value, 10, 510);
}
</script>
    
</html>